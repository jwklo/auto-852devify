(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{4902:function(){},522:function(){},753:function(){},8730:function(){},7355:function(e,t,n){Promise.resolve().then(n.bind(n,2797))},2797:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Home}});var r=n(7437),a=n(3890),i=(n(6264),n(1865)),s=n(2265),l=n(4972),o=n(6061),d=n(7042),c=n(3986);function cn(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,c.m)((0,d.W)(t))}let u=(0,o.j)("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),m=s.forwardRef((e,t)=>{let{className:n,variant:a,size:i,asChild:s=!1,...o}=e,d=s?l.g7:"button";return(0,r.jsx)(d,{className:cn(u({variant:a,size:i,className:n})),ref:t,...o})});m.displayName="Button";let f=s.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:cn("rounded-lg border bg-card text-card-foreground shadow-sm",n),...a})});f.displayName="Card";let g=s.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:cn("flex flex-col space-y-1.5 p-6",n),...a})});g.displayName="CardHeader";let p=s.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("h3",{ref:t,className:cn("text-2xl font-semibold leading-none tracking-tight",n),...a})});p.displayName="CardTitle";let x=s.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("p",{ref:t,className:cn("text-sm text-muted-foreground",n),...a})});x.displayName="CardDescription";let h=s.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:cn("p-6 pt-0",n),...a})});h.displayName="CardContent";let b=s.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:cn("flex items-center p-6 pt-0",n),...a})});b.displayName="CardFooter";let j=s.forwardRef((e,t)=>{let{className:n,type:a,...i}=e;return(0,r.jsx)("input",{type:a,className:cn("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n),ref:t,...i})});function middlePoint(e){let t=e.reduce((e,t)=>e+t.x,0)/e.length,n=e.reduce((e,t)=>e+t.y,0)/e.length;return{x:t,y:n}}j.displayName="Input";var y=n(9948),v=n.n(y),w=n(5817),N=n(6432);function createImageElement(e){return new Promise((t,n)=>{let r=document.createElement("img");r.src=e,r.onload=()=>t(r),r.onerror=n})}function OutputCanvas(e){let{baseImageUri:t,maskImageUri:n,detections:a,showLandmarks:i=!1,showMask:l=!0,photoTitle:o,maskAdjust:d=1,...c}=e,u=(0,s.useRef)(null),[p,x]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{if(!window||!a||!a.length||!t||!n)return;x(!1);let e=setTimeout(async()=>{if(!u.current)return;let e=u.current.getContext("2d",{willReadFrequently:!0});if(!e)return;let r=await createImageElement(t),s=await createImageElement(n);if(u.current.height=r.height,u.current.width=r.width,e.drawImage(r,0,0),i&&N.ii.drawFaceLandmarks(u.current,a),l){let t=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=e.width,r=e.height;return{width:n,height:r,widthAdjust:t}}(s,d);for(let n of a){let[r,a,i,l,o,d]=function(e,t){middlePoint(e.getLeftEye()),middlePoint(e.getRightEye());let n=e.positions[36],r=e.positions[45],a=e.positions[0],i=e.positions[16],s={x:(a.x+n.x)/2,y:(a.y+n.y)/2},l={x:(i.x+r.x)/2,y:(i.y+r.y)/2},o=e.positions[27],[d,c]=[o.x-a.x,o.y-a.y],[u,m]=[o.x-i.x,o.y-i.y],f=Math.sqrt(d*d+c*c),g=Math.sqrt(u*u+m*m);console.log("face:",n,a,r,i,f,g,s,l);let p=g>f?-1:1,x=i.x-a.x,h=i.y-a.y,b=Math.abs(s.x-l.x)*t.widthAdjust,j=Math.abs(b*t.height/t.width);a.x,o.x;let y=o.x;return[y,o.y,b,j,Math.atan2(h,x)*p,p]}(n.landmarks,t);!function(e,t,n,r,a,i,s,l){e.save(),e.translate(n,r),e.scale(l,1),e.rotate(s);let o=.06*a*l;l>0&&(o-=.18*a),console.log(a,o,l),e.drawImage(t,-(a/2)+o,-(i/2),a,i),e.restore()}(e,s,r,a,i,l,o,d)}}x(!0)},50);return()=>clearTimeout(e)},[u,a,t]),(0,r.jsxs)(f,{children:[(0,r.jsx)(g,{children:(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("div",{className:"w-3/4",children:o}),(0,r.jsx)("div",{className:"w-1/4",children:t&&a&&(0,r.jsxs)(m,{onClick:async()=>{if(u.current){let e=await fetch(u.current.toDataURL("image/png"));v()(await e.blob(),"nounified.png")}},disabled:!p,children:[(0,r.jsx)(w.Z,{className:"mr-2 h-6 w-6"}),"Save"]})})]})}),(0,r.jsx)(h,{children:(0,r.jsx)("canvas",{ref:u,...c})}),t&&a&&!p?(0,r.jsx)("div",{className:"absolute inset-0 z-10 bg-black/50"}):null]})}var k=n(8947),_=n(7665);let C=(0,_.cn)({uri:null,maskUri:"./red160px.png",minConfidence:.3,filename:null,maskAdjust:1}),F={noggles1:{widthAdjust:1.2,uri:"./red160px.png",comment:"Width Adjust: noggles width(150), noggles holder(30),due expand 1/5 for better output"},noggles2:{widthAdjust:1.2,uri:"./grey-light160px.png"},noggles3:{widthAdjust:1.2,uri:"./frog-green160px.png"}};function Toolbar(){let e={width:"50px"},t=(0,a.b9)(C),n=[F.noggles1,F.noggles2,F.noggles3],i=n.map(n=>(0,r.jsx)("button",{className:"px-2 border-2 mr-1",children:(0,r.jsx)("img",{src:n.uri,style:e,onClick:e=>{var r;return r=n.widthAdjust,void t(t=>({...t,maskUri:e.target.getAttribute("src"),maskAdjust:r}))}})}));return(0,r.jsx)("div",{className:"h-10 flex flew-row",children:i})}let FileInputForm=()=>{let e=(0,a.b9)(C),{handleSubmit:t,register:n}=(0,i.cI)({defaultValues:{files:[],minConfidence:.3}});return(0,r.jsxs)(f,{className:"mx-auto max-w-lg",children:[(0,r.jsx)(g,{children:(0,r.jsx)(p,{children:"Auto-Nounify your pictures!"})}),(0,r.jsx)(h,{children:(0,r.jsxs)("form",{onSubmit:t(t=>{let{files:n,minConfidence:r}=t;0!==n.length&&e(e=>({...e,uri:URL.createObjectURL(n[0]),minConfidence:r,filename:n[0].name}))}),children:[(0,r.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[(0,r.jsx)(j,{...n("files"),type:"file",id:"files",accept:".jpg,.jpeg,.png"}),(0,r.jsx)(m,{type:"submit",children:"Nounify"})]}),(0,r.jsxs)("div",{className:"flex flex-row mt-2",children:[(0,r.jsxs)("div",{className:"flex flex-row mr-2",children:[(0,r.jsx)("span",{className:"relative top-1/4 mr-2",children:"Min. Conf."}),(0,r.jsx)("input",{className:"shadow rounded w-10",...n("minConfidence",{valueAsNumber:!0})})]}),(0,r.jsx)(Toolbar,{})]})]})})]})};function FaceDetection(){let{uri:e,maskUri:t,minConfidence:n,filename:i,maskAdjust:s}=(0,a.Dv)(C);console.log("faceDetection",t);let l=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.35,{data:n}=(0,k.a)({queryKey:["face-api"],queryFn:async()=>(await N.qB.ssdMobilenetv1.loadFromUri("/models"),await N.qB.faceLandmark68Net.loadFromUri("/models"),!0),staleTime:1/0}),r=!!e&&!!n,{data:a}=(0,k.a)({queryKey:["face-api","detect",e,t],queryFn:async()=>{let n=document.createElement("img");n.src=e;let r=await N.Qr(n,new N.d7({minConfidence:t})).withFaceLandmarks();return null!=r?r:[]},enabled:r});return a}(e,n);return(0,r.jsxs)("div",{className:"relative mx-auto grid h-auto max-w-lg items-center justify-center",children:[null,(0,r.jsx)(OutputCanvas,{detections:l,baseImageUri:e,maskImageUri:t,showLandmarks:!0,photoTitle:i,className:"h-auto max-w-full",maskAdjust:s},"".concat(e))]})}function DemoToBeImproved(){let e=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.35,{data:n}=(0,k.a)({queryKey:["face-api"],queryFn:async()=>(await N.qB.ssdMobilenetv1.loadFromUri("/models"),await N.qB.faceLandmark68Net.loadFromUri("/models"),!0),staleTime:1/0}),r=e.map(e=>{let r=!!e&&!!n,{data:a}=(0,k.a)({queryKey:["face-api","detect",e,t],queryFn:async()=>{let n=document.createElement("img");n.src=e;let r=await N.Qr(n,new N.d7({minConfidence:t})).withFaceLandmarks();return null!=r?r:[]},enabled:r});return{uri:e,filename:e,detections:a}});return r}(["./sample_images/benchmark/1_input.jpg","./sample_images/benchmark/2_input.jpg","./sample_images/benchmark/3_input.jpg","./sample_images/benchmark/4_input.png","./sample_images/benchmark/5_input.jpg","./sample_images/to_be_improved/6_input.jpg","./sample_images/to_be_improved/7_input.jpg","./sample_images/to_be_improved/8_input.jpeg","./sample_images/to_be_improved/9_input.jpg","./sample_images/to_be_improved/10_input.jpeg"],.3),t=e.map(e=>{let{uri:t,filename:n,detections:a}=e;return(0,r.jsx)(OutputCanvas,{detections:a,baseImageUri:t,maskImageUri:"./red160px.png",showLandmarks:!1,photoTitle:n,className:"h-auto max-w-full",maskAdjust:1.2},"".concat(t))});return(0,r.jsx)("div",{children:t})}function Home(){return(0,r.jsx)(r.Fragment,{children:function(){let[e,t]=(0,s.useState)(!1);return e?(0,r.jsxs)("main",{className:"container space-y-4 py-4",children:[(0,r.jsx)("div",{children:(0,r.jsx)(m,{onClick:e=>{t(!1)},children:"FileUpload"})}),(0,r.jsx)(DemoToBeImproved,{})]}):(0,r.jsxs)("main",{className:"container space-y-4 py-4",children:[(0,r.jsx)("div",{children:(0,r.jsx)(m,{onClick:e=>{t(!0)},children:"Demo"})}),(0,r.jsx)(FileInputForm,{}),(0,r.jsx)(FaceDetection,{})]})}()})}}},function(e){e.O(0,[711,64,274,971,864,744],function(){return e(e.s=7355)}),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{4902:function(){},522:function(){},753:function(){},8730:function(){},3514:function(e,t,a){Promise.resolve().then(a.bind(a,7999))},7999:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return Home}});var n,r,s=a(7437),i=a(3890),l=(a(6264),a(1865)),d=a(2265),o=a(4972),c=a(6061),u=a(7042),f=a(3986);function cn(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,f.m)((0,u.W)(t))}let h=(0,c.j)("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),m=d.forwardRef((e,t)=>{let{className:a,variant:n,size:r,asChild:i=!1,...l}=e,d=i?o.g7:"button";return(0,s.jsx)(d,{className:cn(h({variant:n,size:r,className:a})),ref:t,...l})});m.displayName="Button";let x=d.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("div",{ref:t,className:cn("rounded-lg border bg-card text-card-foreground shadow-sm",a),...n})});x.displayName="Card";let g=d.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("div",{ref:t,className:cn("flex flex-col space-y-1.5 p-6",a),...n})});g.displayName="CardHeader";let p=d.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("h3",{ref:t,className:cn("text-2xl font-semibold leading-none tracking-tight",a),...n})});p.displayName="CardTitle";let y=d.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("p",{ref:t,className:cn("text-sm text-muted-foreground",a),...n})});y.displayName="CardDescription";let j=d.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("div",{ref:t,className:cn("p-6 pt-0",a),...n})});j.displayName="CardContent";let v=d.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("div",{ref:t,className:cn("flex items-center p-6 pt-0",a),...n})});v.displayName="CardFooter";let b=d.forwardRef((e,t)=>{let{className:a,type:n,...r}=e;return(0,s.jsx)("input",{type:n,className:cn("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:t,...r})});b.displayName="Input";let w={modelsFolder:"/models",default:{enlarge:1.2,mask:{widthAdjust:1.18,uriL:"./red160px.png",uriR:"./redr160px.png",comment:"Width Adjust: noggles width(160), noggles holder(30),due expand 1/5 for better output"},confidence:.3,flip:!0,showMask:!0,showLM:!1,hideDemoButton:!0}};function middlePoint(e){let t=e.reduce((e,t)=>e+t.x,0)/e.length,a=e.reduce((e,t)=>e+t.y,0)/e.length;return{x:t,y:a}}function getMaskDimension(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=e.width,n=e.height;return{width:a,height:n,widthAdjust:t}}function calcuateMaskPosition(e,t,a,n){let s=middlePoint(t.getLeftEye()),i=middlePoint(t.getRightEye()),l=t.positions[36],d=t.positions[45],o=t.positions[0],c=t.positions[16],u=o.x-c.x,f={x:(o.x+l.x)/2,y:(o.y+l.y)/2},h={x:(c.x+d.x)/2,y:(c.y+d.y)/2},m=t.positions[19],x=t.positions[24],g=t.positions[8],[p,y]=[m.x-g.x,m.y-g.y],[j,v]=[x.x-g.x,x.y-g.y],b=Math.max(Math.sqrt(p*p+y*y),Math.sqrt(j*j+v*v)),w=t.positions[27],[k,N]=[w.x-o.x,w.y-o.y],[M,F]=[w.x-c.x,w.y-c.y],C=Math.sqrt(M*M+F*F)>Math.sqrt(k*k+N*N)&&n?-1:1;switch(e){case r.byEyesMiddle:return(()=>{let e=i.x-s.x,t=i.y-s.y,n=Math.abs(i.x-s.x)*a.widthAdjust,r=Math.abs(n*a.height/a.width),l=(i.x+s.x)/2,d=(i.y+s.y)/2;return[l,d,n,r,Math.atan2(t,e),C]})();case r.byFaceWidth:return(()=>{let e=c.x-o.x,t=c.y-o.y,n=Math.abs(u)*a.widthAdjust,r=Math.abs(n*a.height/a.width),s=w.x,i=w.y;return[s,i,n,r,Math.atan2(t,e),C]})();case r.fullFace:return(()=>{let e=c.x-o.x,t=c.y-o.y,n=Math.abs(u)*a.widthAdjust,r=w.x,s=w.y;return[r,s,n,b,Math.atan2(t,e),C]})();default:return(()=>{let e=h.x-f.x,t=h.y-f.y,n=Math.abs(f.x-h.x)*a.widthAdjust,r=Math.abs(n*a.height/a.width),s=w.x,i=w.y;return[s,i,n,r,Math.atan2(t,e),C]})()}}(n=r||(r={}))[n.byFaceEyesWidth=0]="byFaceEyesWidth",n[n.byEyesMiddle=1]="byEyesMiddle",n[n.byFaceWidth=2]="byFaceWidth",n[n.fullFace=3]="fullFace";var k=a(9948),N=a.n(k),M=a(5817),F=a(6432);function drawRotatedImage(e,t,a,n,r,s,i,l,d,o,c){e.save(),e.translate(r,s),e.rotate(d);let u=i*(n-1)*o*c,f=o>0?t:a;return i*=c,l*=c,e.drawImage(f,-((i+u)/2),-(l/2),i,l),e.restore(),e}function createImageElement(e){return new Promise((t,a)=>{let n=document.createElement("img");n.src=e,n.onload=()=>t(n),n.onerror=a})}function OutputCanvas(e){let{baseImageUri:t,maskImageLUri:a,maskImageRUri:n,enlarge:r=1,detections:i,showLandmarks:l,showMask:o,flipMask:c,photoTitle:u,maskAdjust:f=1,maskType:h=0,...p}=e,y=(0,d.useRef)(null),[v,b]=(0,d.useState)(!1);return(0,d.useEffect)(()=>{if(!window||!i||!i.length||!t||!a||!n)return;b(!1);let e=setTimeout(async()=>{if(!y.current)return;let e=y.current.getContext("2d",{willReadFrequently:!0});if(!e)return;let s=await createImageElement(t),d=await createImageElement(a),u=await createImageElement(n);if(y.current.height=s.height,y.current.width=s.width,e.drawImage(s,0,0),l&&F.ii.drawFaceLandmarks(y.current,i),console.log(i),o){let t=getMaskDimension(d,f);for(let a of i){let[n,s,i,l,o,m]=calcuateMaskPosition(h,a.landmarks,t,c);drawRotatedImage(e,d,u,f,n,s,i,l,o,c?m:1,r)}}b(!0)},50);return()=>clearTimeout(e)},[y,i,t,l,o,c,a,n,f,h]),(0,s.jsxs)(x,{children:[(0,s.jsx)(g,{children:(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("div",{className:"w-3/4",children:u}),(0,s.jsx)("div",{className:"w-1/4",children:t&&i&&(0,s.jsxs)(m,{onClick:async()=>{if(y.current){let e=await fetch(y.current.toDataURL("image/png"));N()(await e.blob(),"852devify.png")}},disabled:!v,children:[(0,s.jsx)(M.Z,{className:"mr-2 h-6 w-6"}),"Save"]})})]})}),(0,s.jsx)(j,{children:(0,s.jsx)("canvas",{ref:y,...p})}),t&&i&&!v?(0,s.jsx)("div",{className:"absolute inset-0 z-10 bg-black/50"}):null]})}var C=a(8947);function initialFaceApi(){let{data:e}=(0,C.a)({queryKey:["face-api"],queryFn:async()=>(await F.qB.ssdMobilenetv1.loadFromUri(w.modelsFolder),await F.qB.faceLandmark68Net.loadFromUri(w.modelsFolder),!0),staleTime:1/0});return e}function loadFaceLandmarks(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.35,n=!!t&&!!e,{data:r}=(0,C.a)({queryKey:["face-api","detect",t,a],queryFn:async()=>{let e=document.createElement("img");e.src=t;let n=await F.Qr(e,new F.d7({minConfidence:a})).withFaceLandmarks();return null!=n?n:[]},enabled:n});return r}function singlePhotoFaceDetection(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.35;console.log("singlePhotoFaceDetection",t);let a=initialFaceApi(),n=loadFaceLandmarks(a,e,t);return n}var L=a(7665);let R=(0,L.cn)({uri:null,maskLUri:w.default.mask.uriL,maskRUri:w.default.mask.uriR,minConfidence:w.default.confidence,filename:null,maskAdjust:w.default.mask.widthAdjust,flip:w.default.flip,showMask:w.default.showMask,showLM:w.default.showLM,maskType:0});function Toolbar(){let e={width:"50px"},t=(0,i.b9)(R),{maskLUri:a,maskRUri:n,maskAdjust:l,minConfidence:d,flip:o,showMask:c,showLM:u,maskType:f}=(0,i.Dv)(R);function chkHandler(e,a){var n;console.log("chkHandler",a,null===(n=e.target)||void 0===n?void 0:n.checked),"flip"==a&&t(t=>{var a;return{...t,flip:null===(a=e.target)||void 0===a?void 0:a.checked}}),"showMask"==a&&t(t=>{var a;return{...t,showMask:null===(a=e.target)||void 0===a?void 0:a.checked}}),"showLM"==a&&t(t=>{var a;return{...t,showLM:null===(a=e.target)||void 0===a?void 0:a.checked}})}function minConfidenceHandler(e){console.log("minConfidenceHandler",e.target.value),t(t=>({...t,minConfidence:parseFloat(e.target.value)}))}function widthAdjustHandler(e){var a;console.log("widthAdjustHandler",e.target.value),(null===(a=e.target)||void 0===a?void 0:a.value)&&t(t=>({...t,maskAdjust:parseFloat(e.target.value)}))}function maskTypeHandler(e){var a;if(console.log("maskTypeHandler",e.target.value),null===(a=e.target)||void 0===a?void 0:a.value){let a=parseInt(e.target.value);t(e=>({...e,maskType:a}))}}function changeMaskLeftHandler(e){if(e.currentTarget.files&&1==e.currentTarget.files.length){let a=URL.createObjectURL(e.currentTarget.files[0]);t(e=>({...e,maskLUri:a}))}}function changeMaskRightHandler(e,a){if(e.currentTarget.files&&1==e.currentTarget.files.length){let a=URL.createObjectURL(e.currentTarget.files[0]);t(e=>({...e,maskRUri:a}))}}function MaskButton(t){return t.uri?(0,s.jsxs)("div",{className:"bg-black rounded-sm w-20 flex flex-col",children:[(0,s.jsx)("div",{className:"text-white text-xs text-center",children:t.title}),(0,s.jsx)("button",{className:"bg-white px-2 border-2",children:(0,s.jsx)("img",{src:t.uri,style:e})},t.buttonKey),(0,s.jsx)("input",{onChange:e=>t.changeHandler(e),type:"file",id:"files",accept:".jpg,.jpeg,.png"})]}):(0,s.jsxs)("div",{className:"bg-black rounded-sm w-20 flex flex-col",children:[(0,s.jsx)("div",{className:"text-white text-xs text-center",children:t.title}),(0,s.jsx)("input",{onChange:e=>t.changeHandler(e),type:"file",id:"files",accept:".jpg,.jpeg,.png"})]})}function MaskTypeOptions(){let e=Object.keys(r).filter(e=>isNaN(Number(e)));return e.map((e,t)=>(0,s.jsx)("option",{value:t,children:e},e))}return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex flex-row justify-start gap-x-1",children:[(0,s.jsx)(MaskButton,{title:"Left",buttonKey:"maskLUri",uri:a,changeHandler:changeMaskLeftHandler}),(0,s.jsx)(MaskButton,{title:"Right",buttonKey:"maskRUri",uri:n,changeHandler:changeMaskRightHandler}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsxs)("div",{className:"flex flex-row border-2 justify-stretch",children:[(0,s.jsx)("label",{className:"w-32",children:"Mask Type"}),(0,s.jsx)("select",{className:"shadow rounded",onChange:maskTypeHandler,children:MaskTypeOptions()})]}),(0,s.jsxs)("div",{className:"flex flex-row border-2 justify-stretch",children:[(0,s.jsx)("label",{className:"w-32 justify-self-start",children:"Min. Conf."}),(0,s.jsx)("input",{className:"shadow rounded",name:"minConfidence",type:"number",defaultValue:d,step:"0.05",onChange:minConfidenceHandler})]}),(0,s.jsxs)("div",{className:"flex flex-row border-2 justify-stretch",children:[(0,s.jsx)("span",{className:"w-32",children:"Width Adjust"}),(0,s.jsx)("input",{className:"shadow rounded",name:"widthAdjust",type:"number",defaultValue:l,step:"0.01",onChange:widthAdjustHandler})]})]})]}),(0,s.jsxs)("div",{className:"h-10 flex flew-row",children:[(0,s.jsx)("div",{className:"ml-1",children:(0,s.jsxs)("span",{className:"relative top-1/4 mr-2",children:["Auto-Flip",(0,s.jsx)("input",{type:"checkbox",onChange:e=>chkHandler(e,"flip"),defaultChecked:o,name:"chkFlip"})]})}),(0,s.jsx)("div",{className:"ml-1",children:(0,s.jsxs)("span",{className:"relative top-1/4 mr-2",children:["Auto-Mask",(0,s.jsx)("input",{type:"checkbox",onChange:e=>chkHandler(e,"showMask"),defaultChecked:c,name:"chkMask"})]})}),(0,s.jsx)("div",{className:"ml-1",children:(0,s.jsxs)("span",{className:"relative top-1/4 mr-2",children:["Show-Landmarks",(0,s.jsx)("input",{type:"checkbox",onChange:e=>chkHandler(e,"showLM"),defaultChecked:u,name:"chkLM"})]})})]})]})}let FileInputForm=()=>{let e=(0,i.b9)(R),{handleSubmit:t,register:a}=(0,l.cI)({defaultValues:{files:[]}});return(0,s.jsxs)(x,{className:"mx-auto max-w-lg",children:[(0,s.jsx)(g,{children:(0,s.jsx)(p,{children:"Auto-Nounify your pictures!"})}),(0,s.jsx)(j,{children:(0,s.jsxs)("form",{onSubmit:t(t=>{let{files:a}=t;0!==a.length&&e(e=>({...e,uri:URL.createObjectURL(a[0]),filename:a[0].name}))}),children:[(0,s.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[(0,s.jsx)(b,{...a("files"),type:"file",id:"files",accept:".jpg,.jpeg,.png"}),(0,s.jsx)(m,{type:"submit",children:"Nounify"})]}),(0,s.jsx)("div",{className:"flex flex-col mt-2",children:(0,s.jsx)(Toolbar,{})})]})})]})};function FaceDetection(){let{uri:e,maskLUri:t,maskRUri:a,minConfidence:n,filename:r,maskAdjust:l,flip:d,showMask:o,showLM:c,maskType:u}=(0,i.Dv)(R),f=singlePhotoFaceDetection(e,n);return(0,s.jsxs)("div",{className:"relative mx-auto grid h-auto max-w-lg items-center justify-center",children:[null,(0,s.jsx)(OutputCanvas,{detections:f,baseImageUri:e,maskImageLUri:t,maskImageRUri:a,showLandmarks:c,showMask:o,maskType:u,flipMask:d,photoTitle:r,className:"h-auto max-w-full",maskAdjust:l,enlarge:w.default.enlarge},"".concat(e))]})}function content(){return(0,s.jsxs)("main",{className:"container space-y-4 py-4",children:[(0,s.jsx)(FileInputForm,{}),(0,s.jsx)(FaceDetection,{})]})}function Home(){return(0,s.jsx)(s.Fragment,{children:content()})}}},function(e){e.O(0,[711,64,274,971,472,744],function(){return e(e.s=3514)}),_N_E=e.O()}]);